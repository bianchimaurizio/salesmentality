<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energia per il Team</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #e2e8f0;
            padding-bottom: 80px; /* Aggiunto per evitare che il contenuto venga coperto dal footer */
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #161b22;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #21262d;
            width: 90%;
            max-width: 800px;
            border-radius: 12px;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        .track-pill-button {
            opacity: 0;
            cursor: not-allowed;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .track-pill-button.active {
            opacity: 1;
            pointer-events: auto;
        }
        /* Stili per l'effetto neon (versione più soft) */
        .neon-text {
            color: #fff;
            text-shadow:
                0 0 3px #fff,
                0 0 6px #fff,
                0 0 10px #fff,
                0 0 15px #00e5ff,
                0 0 20px #00e5ff,
                0 0 25px #00e5ff,
                0 0 30px #00e5ff;
            animation: pulsate-neon 2s ease-in-out infinite alternate;
        }

        @keyframes pulsate-neon {
            from {
                text-shadow:
                    0 0 3px #fff,
                    0 0 6px #fff,
                    0 0 10px #fff,
                    0 0 15px #00e5ff,
                    0 0 20px #00e5ff,
                    0 0 25px #00e5ff,
                    0 0 30px #00e5ff;
            }
            to {
                text-shadow:
                    0 0 1.5px #fff,
                    0 0 3px #fff,
                    0 0 5px #fff,
                    0 0 7.5px #00e5ff,
                    0 0 10px #00e5ff,
                    0 0 12.5px #00e5ff,
                    0 0 15px #00e5ff;
            }
        }
        /* Stili per la sezione contestualizza obiezione */
        .objection-section-border {
            border-color: #10b981;
        }
        .objection-button-gradient {
            background-image: linear-gradient(to right, #10b981, #34d399);
        }
        .objection-button-gradient:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.5), 0 2px 4px -1px rgba(16, 185, 129, 0.5);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Sezione principale dell'app -->
    <div class="max-w-4xl mx-auto space-y-8">
        
        <!-- Intestazione e descrizione -->
        <header class="text-center space-y-2">
            <h1 class="text-4xl sm:text-5xl font-extrabold neon-text leading-tight">La tua Dose di Energia Quotidiana</h1>
            <p class="text-lg sm:text-xl text-gray-400 italic">I tuoi video, le tue pillole, il tuo supporto, i tuoi libri, per diventare un vero carro armato</p>
        </header>

        <!-- Contenuto dell'app -->
        <div id="app-container">
            <!-- Interfaccia di inserimento nome -->
            <div id="nameInputSection" class="text-center p-6 bg-[#161b22] rounded-xl shadow-lg border border-[#21262d] space-y-4">
                <h2 class="text-2xl font-bold mb-4 text-white">Ciao, inserisci il tuo nome per iniziare.</h2>
                <input id="userNameInput" type="text" placeholder="Il tuo nome" class="bg-gray-700 text-white p-3 rounded-lg w-full md:w-1/2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="startButton" class="w-full md:w-1/2 px-8 py-4 text-lg font-bold text-white bg-gradient-to-r from-green-500 to-lime-600 rounded-full transition-transform transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50">
                    Inizia il tuo percorso
                </button>
            </div>
            
            <!-- Interfaccia principale con video e pulsante -->
            <div id="mainAppSection" class="hidden">
                <p id="welcomeMessage" class="text-center text-lg sm:text-xl text-gray-400 mb-6">Benvenuto, <span id="userNameDisplay" class="font-bold"></span>!</p>
                
                <!-- Barra di avanzamento e contatori -->
                <div class="flex flex-col items-center mb-6">
                    <div class="w-full max-w-sm mb-2">
                        <div class="relative pt-1">
                            <div class="overflow-hidden h-4 mb-4 text-xs flex rounded bg-gray-700">
                                <div id="progressBar" style="width:0%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500 ease-in-out"></div>
                            </div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-400">
                            <span id="progressPercentage">0%</span>
                            <span id="videoProgressDisplay">Video visti: 0 su 30</span>
                        </div>
                    </div>
                    <span id="pilloleProgressDisplay" class="text-sm text-gray-400">Pillole lette: 0</span>
                </div>

                <div id="videoContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- I video verranno caricati qui dal JavaScript -->
                </div>
                <div class="text-center p-6 bg-[#161b22] rounded-xl shadow-lg border border-[#21262d] mt-8">
                    <h2 class="text-2xl font-bold mb-4 text-white">Pronto a spaccare?</h2>
                    <p class="text-gray-400 mb-6">Dopo aver guardato almeno un video, clicca qui per proseguire.</p>
                    <a id="confirmButton" href="#" class="inline-block px-8 py-4 text-lg font-bold text-white bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full transition-transform transform opacity-50 cursor-not-allowed hover:scale-105 hover:shadow-lg">
                        Conferma di aver visto
                    </a>
                    <button id="powerPillButton" class="w-full md:w-1/2 px-8 py-4 mt-4 text-lg font-bold text-white bg-gradient-to-r from-purple-600 to-fuchsia-600 rounded-full transition-transform transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50">
                        Pillola di Potenza
                    </button>
                </div>
                
                <!-- Nuova sezione per il coach AI -->
                <div class="text-center p-6 bg-[#161b22] rounded-xl shadow-lg border border-[#21262d] mt-8">
                    <h2 class="text-2xl font-bold mb-4 text-white">Ottieni una risposta al tuo blocco</h2>
                    <p class="text-gray-400 mb-6">Scrivi qui un tuo dubbio, una tua paura o un tuo blocco e ricevi una risposta diretta.</p>
                    <textarea id="aiInput" class="bg-gray-700 text-white p-3 rounded-lg w-full h-24 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Per esempio: 'Ho paura di fare la prima chiamata' o 'Non riesco a superare un no'"></textarea>
                    <button id="aiButton" class="w-full px-8 py-4 mt-4 text-lg font-bold text-white bg-gradient-to-r from-red-600 to-orange-600 rounded-full transition-transform transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50">
                        Ottieni la risposta
                    </button>
                    <div id="aiResponse" class="mt-6 text-left p-4 bg-gray-800 rounded-lg">
                        <p id="aiResponseText" class="text-lg text-gray-300 italic"></p>
                    </div>
                </div>

                <!-- Nuova sezione per i libri -->
                <div class="text-center p-6 bg-[#161b22] rounded-xl shadow-lg border border-[#21262d] mt-8">
                    <h2 class="text-2xl font-bold mb-4 text-white">10 Libri Essenziali per ogni Venditore</h2>
                    <p class="text-gray-400 mb-6">Scopri l'essenza di questi capolavori in riassunti basati sulla regola dell'80/20. Clicca su un libro per sbloccare i concetti più potenti.</p>
                    <div id="bookContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Le card dei libri verranno caricate qui dal JavaScript -->
                    </div>
                </div>

                <!-- Nuova sezione per il closer AI -->
                <div class="text-center p-6 bg-[#161b22] rounded-xl shadow-lg border border-4 border-[#10b981] mt-8">
                    <h2 class="text-2xl font-bold mb-4 text-white">Contestualizza un'obiezione che credi di gestire male o che ti spaventa</h2>
                    <p class="text-gray-400 mb-6">Ottieni un'analisi concisa, un esempio pratico, una riflessione strategica.</p>
                    <textarea id="objectionInput" class="bg-gray-700 text-white p-3 rounded-lg w-full h-24 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Scrivi qui un'obiezione contestualizzata che credi di gestire male o che ti spaventa"></textarea>
                    <button id="objectionButton" class="w-full px-8 py-4 mt-4 text-lg font-bold text-white bg-gradient-to-r from-green-500 to-lime-600 rounded-full transition-transform transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50">
                        Ottieni la risposta
                    </button>
                    <div id="objectionResponse" class="mt-6 text-left p-4 bg-gray-800 rounded-lg">
                        <p id="objectionResponseText" class="text-lg text-gray-300 italic"></p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modale per le pillole di potenza e i libri -->
    <div id="powerPillModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="pillTitle" class="text-3xl font-bold mb-4 text-white text-center"></h2>
            <p id="pillProgress" class="text-sm text-gray-400 text-center mb-6"></p>
            <div class="prose prose-invert max-w-none text-left" id="pillContent">
                <!-- Il contenuto verrà caricato qui dal JavaScript -->
            </div>
            <div class="text-center mt-6">
                <button id="nextPillButton" class="px-8 py-4 text-lg font-bold text-white bg-blue-600 rounded-full transition-transform transform hover:scale-105 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                    Prossima pagina
                </button>
            </div>
        </div>
    </div>

    <!-- Footer per l'importazione/esportazione -->
    <footer class="fixed bottom-0 left-0 right-0 p-4 sm:p-2 bg-[#161b22] border-t border-[#21262d] flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-4">
        <h3 class="text-sm text-gray-400 font-bold mb-0">Salva o carica i tuoi progressi:</h3>
        <div class="flex space-x-2">
            <button id="exportButton" class="px-4 py-2 text-sm font-bold text-white bg-gray-600 rounded-full transition-transform transform hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-50">
                Esporta
            </button>
            <label for="importFile" class="inline-block px-4 py-2 text-sm font-bold text-white bg-gray-600 rounded-full transition-transform transform hover:scale-105 hover:shadow-lg cursor-pointer">
                Importa
                <input type="file" id="importFile" accept=".json" class="hidden">
            </label>
        </div>
    </footer>

    <script>
        // Array di oggetti contenenti i dati dei 30 video
        const videos = [
            { title: "Mindset Vincente", description: "Il potere della mentalità del campione.", url: "https://www.youtube.com/embed/nU7_T3lP6zY" },
            { title: "L'Arte della Negoziazione", description: "Le tecniche del \"Lupo di Wall Street\".", url: "https://www.youtube.com/embed/g2g-n2gM6mY" },
            { title: "Resilienza e Ostacoli", description: "Storie vere che dimostrano che gli ostacoli sono solo un'opportunità.", url: "https://www.youtube.com/embed/hB5wV26bJgA" },
            { title: "Carica di Adrenalina", description: "Una carica di adrenalina per la tua giornata. Sii inarrestabile.", url: "https://www.youtube.com/embed/Pj17d-K-y4E" },
            { title: "Imprenditorialità senza filtri", description: "Consigli diretti e brutali da chi ha costruito un impero.", url: "https://www.youtube.com/embed/RkQh-vYx_lY" },
            { title: "Pillola di Vendita", description: "La disciplina non è un'opzione. È un'ossessione.", url: "https://www.youtube.com/embed/s2B7vA9g0m8" },
            { title: "Emozioni al Comando", description: "La mentalità che ha reso una leggenda inarrestabile.", url: "https://www.youtube.com/embed/rK5n592tYqE" },
            { title: "L'Arte della Negoziazione", description: "Le strategie pratiche per chiudere un affare in qualsiasi situazione.", url: "https://www.youtube.com/embed/vH4dO5wYg" },
            { title: "Motivazione Aggressiva", description: "Per i giorni in cui hai bisogno di un pugno nello stomaco per svegliarti. Nessuna scusa.", url: "https://www.youtube.com/embed/c1fNl_m1c4I" },
            { title: "La Legge della Vendita", description: "Le regole non scritte del gioco. Impara, applica e domina.", url: "https://www.youtube.com/embed/gB8j10_4r5s" },
            { title: "Il Successo è un Dovere", description: "Non un'opzione, ma un dovere. Una dose di mentalità per i veri vincenti.", url: "https://www.youtube.com/embed/3m4aTj0D9I" },
            { title: "Superare la Paura", description: "La paura è l'unica cosa che ti ferma. Distruggila.", url: "https://www.youtube.com/embed/7V-tH-g1D_o" },
            { title: "La Regola del 10X", description: "Agisci con un'intensità 10 volte superiore per ottenere risultati 10 volte migliori.", url: "https://www.youtube.com/embed/X-L1s3t0g" },
            { title: "L'Approccio del Guerriero", description: "Ogni sfida è una battaglia da vincere. Non ritirati mai.", url: "https://www.youtube.com/embed/n4sO_QoP6uQ" },
            { title: "La Legge della Vendita 2.0", description: "Approfondimenti sulla legge della vendita. Dalle basi all'eccellenza.", url: "https://www.youtube.com/embed/qjT1z_f6D0g" },
            { title: "La Mentalità del Lupo", description: "Sii un predatore, non una preda. Il tuo istinto di vendita deve essere affamato.", url: "https://www.youtube.com/embed/QJ78xW98d7o" },
            { title: "Costruire l'Abito da Venditore", description: "Non si nasce un vincente, lo si diventa. Il sacrificio è la strada maestra.", url: "https://www.youtube.com/embed/4b9Xw_Q4t0g" },
            { title: "L'Arte della Persuasione", description: "Le parole hanno un potere immenso. Impara a usarle a tuo favore.", url: "https://www.youtube.com/embed/fU3-Z_L1h4o" },
            { title: "L'Eterno Venditore", description: "Un venditore è un venditore per sempre, non per caso.", url: "https://www.youtube.com/embed/w7S-qN54RjY" },
            { title: "Costruire l'Impero", description: "Visione, coraggio e un po' di arroganza.", url: "https://www.youtube.com/embed/S_8qR4b7l0w" },
            { title: "Agisci Adesso", description: "Il momento giusto è ora. Non rimandare, non aspettare. Fallo.", url: "https://www.youtube.com/embed/d23tQn-p1D0" },
            { title: "Metti a Tacere il Dubbio", description: "Il dubbio è il tuo nemico. Sii la persona più sicura che conosci.", url: "https://www.youtube.com/embed/M3j3d-B8C1Y" },
            { title: "L'Eredità della Vendita", description: "I grandi venditori lasciano un segno. Quale sarà il tuo?", url: "https://www.youtube.com/embed/nU7_T3lP6zY" },
            { title: "La Fame di Successo", description: "Non puoi insegnare la fame. O ce l'hai, o non ce l'hai.", url: "https://www.youtube.com/embed/qFj6j93j_jY" },
            { title: "L'Approccio Psicologico", description: "Capisci la mente del cliente, domini la vendita.", url: "https://www.youtube.com/embed/d23tQn-p1D0" },
            { title: "L'Arte della Persuasione 2.0", description: "Come far sì che il \"sì\" sia l'unica opzione.", url: "https://www.youtube.com/embed/5Kq_3j3vA7E" },
            { title: "Il Potere della Negoziazione", description: "Trasforma ogni no in una vittoria. Non arrenderti mai.", url: "https://www.youtube.com/embed/6q2n8-sF0_w" },
            { title: "La Grinta di un Venditore", description: "La motivazione è temporanea, la grinta è per sempre.", url: "https://www.youtube.com/embed/m7wFf6l0f4g" },
            { title: "Mentalità d'Acciaio", description: "Non farti fermare da nulla, mai.", url: "https://www.youtube.com/embed/b0u9B0iP3Xg" },
            { title: "Il Segreto del Successo", description: "Non c'è magia. Solo lavoro duro e perseveranza.", url: "https://www.youtube.com/embed/n4sO_QoP6uQ" }
        ];
        
        // --- Contenuti per le pillole di potenza (primi 10) ---
        const pilloleDiPotenza = [
            {
                title: "1. Il No che ti fortifica",
                content: "Il 'no' non è un rifiuto, è un'informazione che ti indica dove migliorare. Ogni 'no' è una spinta per la tua crescita. Non prenderla sul personale, analizzala, impara e usa quella forza per diventare inarrestabile. Il tuo valore si misura dalla capacità di rialzarti dopo ogni caduta."
            },
            {
                title: "2. Il dubbio è un veleno",
                content: "La prima battaglia di ogni giorno è nella tua mente. Il dubbio è il veleno che uccide le vendite prima ancora che inizino. Metti a tacere la voce che ti dice 'non ce la farai'. La fiducia in te stesso è la prima cosa che devi vendere."
            },
            {
                title: "3. La paura della chiamata",
                content: "Non è la chiamata che ti spaventa, è il risultato incerto. La paura non è un fatto, ma un'emozione. La tua forza si dimostra quando agisci nonostante essa. Ogni volta che alzi il telefono, non stai solo cercando di vendere, stai dimostrando a te stesso che sei più forte di ogni paura."
            },
            {
                title: "4. L'energia è contagiosa",
                content: "La tua energia è il tuo capitale più prezioso. Dimentica la stanchezza, dimentica la pigrizia. La tua carica emotiva è la prima cosa che il cliente percepisce. Sii il sole che entra nella stanza, non l'ombra. Trasmetti la tua energia, perché sarà la prima cosa che compreranno da te."
            },
            {
                title: "5. L'arte dell'incisività",
                content: "La padronanza della parola non è essere eloquenti, ma essere incisivi. Ogni parola è un proiettile, non sprecarne neanche uno. Vai dritto al punto. Sii chiaro, diretto, inequivocabile. La tua incisività è la chiave che apre le porte della vendita."
            },
            {
                title: "6. L'unica opzione è il successo",
                content: "Non ci sono piani B. Se c'è un piano B, il piano A non funzionerà. Il successo non è un'opzione, è un dovere. Un dovere verso te stesso, il tuo team, i tuoi clienti. Credi nel tuo valore, credi nel tuo successo. Fino a quando l'unica opzione che contempli è la vittoria, sarai inarrestabile."
            },
            {
                title: "7. La perseveranza è un'arma",
                content: "Il successo non è una linea retta, è una strada fatta di salite, ostacoli e cadute. La differenza tra chi vince e chi perde non è l'assenza di sconfitte, ma la perseveranza nel rialzarsi ogni volta. Sii un martello che continua a battere, finché non ottieni ciò che vuoi."
            },
            {
                title: "8. Il fuoco dentro",
                content: "Non puoi vendere con gli occhi spenti. La passione per quello che fai è il fuoco che ti spinge ad andare avanti, anche quando tutto sembra crollare. Riaccendi quel fuoco ogni mattina. La tua passione è la benzina del tuo motore."
            },
            {
                title: "9. La mentalità del campione",
                content: "Un campione non si allena per vincere, si allena per non perdere. La mentalità del campione è quella che ti spinge a fare quel chilometro in più, quella telefonata in più. Non ti accontenti della mediocrità. Ti spingi oltre i tuoi limiti. Sii il campione che sai di essere."
            },
            {
                title: "10. Sii la soluzione",
                content: "Non sei un venditore, sei un risolutore di problemi. I tuoi clienti non hanno bisogno di un prodotto, hanno bisogno di una soluzione. Sii un esperto nel loro problema, sii un esperto nella tua soluzione. Sii la persona che risolve i loro problemi, e la vendita sarà una naturale conseguenza."
            }
        ];

        // --- Dati dei libri ---
        const booksData = [
            {
                id: 'carnegie',
                title: "Come trattare gli altri e farseli amici",
                author: "Dale Carnegie",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">La tua più grande vendita non è un prodotto, ma la fiducia e la connessione che crei con le persone. Il successo non si misura da quante volte chiudi, ma da quanto le persone vogliono stare con te, perché il tuo valore è il valore che porti a loro.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>La vendita è una questione di fiducia, di connessione umana e di empatia, non di persuasione aggressiva. Questo libro ti insegna a capire le persone, il che ti renderà un venditore etico e di successo, in grado di costruire legami duraturi e non solo di chiudere una singola transazione. Imparare a **comprendere le motivazioni degli altri e a persuadere in modo etico** è il cuore di ogni vendita di successo, e il libro rimane un caposaldo per la crescita personale e professionale.</p>
<ul class="mt-4">
    <li>**Sii sinceramente interessato agli altri.** Fai domande aperte, ascolta con attenzione senza interrompere e mostra un interesse genuino per le loro storie, i loro bisogni e le loro motivazioni. Le persone sono più disposte ad ascoltare te se prima hanno la sensazione di essere state ascoltate.</li>
    <li>**Sorridi e mostra entusiasmo.** Un sorriso è un segnale universale di apertura e positività. La tua energia e il tuo atteggiamento influenzeranno la percezione che il cliente ha di te e della tua proposta. L'entusiasmo è contagioso e può abbattere le barriere iniziali.</li>
    <li>**Ricorda e usa il nome di una persona.** Per una persona, il proprio nome è il suono più importante. Usare il nome del cliente durante la conversazione dimostra attenzione, rispetto e rafforza il legame personale, creando un ambiente di maggiore fiducia.</li>
    <li>**Sii un buon ascoltatore.** Incoraggia gli altri a parlare di se stessi e dei loro problemi. Più ascolti, più informazioni acquisisci sui loro bisogni, sulle loro paure e sui loro desideri. Non si tratta di rispondere, ma di comprendere a fondo.</li>
    <li>**Fai sentire l'altra persona importante.** Apprezza sinceramente e complimentati per i loro successi o per le loro idee. Evita di criticare o condannare. Dare riconoscimento e valore all'interlocutore crea un rapporto di collaborazione, non di conflitto.</li>
    <li>**Inizia con un approccio amichevole.** Cerca sempre di creare un'atmosfera positiva e di intesa prima di entrare nel vivo della vendita. Le persone sono più aperte a discutere e a trattare se si sentono a proprio agio e non sotto pressione.</li>
</ul>
`
            },
            {
                id: 'tracy',
                title: "La psicologia della vendita",
                author: "Brian Tracy",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Il tuo conto in banca è direttamente proporzionale al tuo mindset: smetti di inseguire la vendita e inizia a domare la tua mente, perché il successo non è una tecnica, ma una condizione interiore che ti rende inarrestabile.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>La vendita è prima di tutto un gioco mentale e solo secondariamente un processo di tecniche e abilità. La tua autostima e la tua convinzione nel valore di ciò che vendi sono i tuoi asset più importanti. In questo libro, Brian Tracy condensa decenni di esperienza, offrendo strategie pratiche per **superare le obiezioni, gestire il tempo e aumentare la fiducia in se stessi**, fornendo tecniche immediatamente applicabili per migliorare le performance.</p>
<ul class="mt-4">
    <li>**Accetta il rifiuto come parte del processo.** I "no" non sono un rifiuto personale, ma semplicemente un dato di fatto. Ogni "no" ti avvicina statisticamente a un "sì". Sviluppa una "pelle spessa" e una mentalità di crescita, vedendo ogni rifiuto come un'opportunità di imparare e migliorare il tuo approccio.</li>
    <li>**Sii un esperto.** Conosci il tuo prodotto, i tuoi concorrenti e il tuo mercato meglio di chiunque altro. La fiducia nella tua competenza non solo ti rende più sicuro di te, ma ti permette di rispondere a qualsiasi obiezione con autorevolezza, posizionandoti come un consulente fidato, non un semplice venditore.</li>
    <li>**Fai le domande giuste.** Non parlare troppo. Fai domande mirate e strategiche per identificare i problemi, i bisogni e i desideri non espressi del cliente. Più un cliente parla, più si sente coinvolto nel processo e più è probabile che si convinca della necessità di una soluzione.</li>
    <li>**Agisci con urgenza.** La vendita è energia in azione. Non rimandare le chiamate difficili o le decisioni importanti. La velocità è un fattore competitivo chiave. "Fallo subito" è il motto che deve guidare la tua giornata.</li>
    <li>**Visualizza il successo.** Prima di ogni chiamata o incontro, visualizza l'esito positivo. Immagina te stesso che chiudi la vendita, che risolvi il problema del cliente e che ricevi il suo ringraziamento. La mente non distingue tra un obiettivo visualizzato e uno reale, e ti darà la spinta necessaria per agire in modo vincente.</li>
    <li>**Concentrati sul problema.** I clienti non comprano il tuo prodotto, comprano la soluzione a un loro problema. Presenta il tuo prodotto non come un insieme di funzionalità, ma come il ponte che li porterà da una situazione problematica a una ideale.</li>
</ul>
`
            },
            {
                id: 'rackham',
                title: "SPIN Selling",
                author: "Neil Rackham",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Smetti di essere un venditore e diventa un risolutore di problemi. Il tuo successo non si nasconde nella tua capacità di rispondere, ma nel coraggio di fare le domande giuste che svelano al cliente ciò che lui stesso non sa di aver bisogno.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>La vendita non è un'arte della persuasione, ma della scoperta. Si tratta di aiutare il cliente a scoprire i suoi bisogni latenti e a realizzare il valore della tua proposta, piuttosto che spingere un prodotto che non vuole o di cui non capisce il valore. Basato su una ricerca approfondita su migliaia di trattative, Rackham introduce il modello SPIN (Situazione, Problema, Implicazione, Necessità di soluzione), un processo di domande che guida il cliente a **chiedere autonomamente la tua soluzione**, rendendo il processo di vendita molto più efficace e orientato al valore.</p>
<ul class="mt-4">
    <li>**S. (Situazione):** Inizia con domande per raccogliere informazioni generali sulla situazione attuale del cliente. Che ruolo ha in azienda? Che strumenti usa? L'obiettivo è capire il contesto in cui si muove. Non esagerare, perché troppe domande situazionali annoiano il cliente.</li>
    <li>**P. (Problema):** Chiedi in modo specifico dei problemi, delle difficoltà o degli insoddisfazioni che sta affrontando. "Ci sono problemi con il sistema attuale?" o "Che sfide state incontrando?". L'obiettivo è identificare un'area di disagio che puoi risolvere.</li>
    <li>**I. (Implicazione):** Fai domande che facciano capire le conseguenze negative del problema. "Che impatto ha questo problema sul budget, sulla produttività o sul morale del team?". Le domande di implicazione trasformano un piccolo problema in una grande necessità.</li>
    <li>**N. (Necessità di soluzione):** Fai domande che spingano il cliente a esprimere il desiderio di una soluzione e a capire i benefici del tuo prodotto. "Quanto sarebbe importante per te risolvere questo problema?" o "Come ti aiuterebbe una soluzione che...". A questo punto, il cliente stesso ti sta chiedendo la soluzione.</li>
    <li>**Il ruolo del venditore cambia.** Non sei più un oratore che elenca le funzionalità, ma un consulente fidato che guida il cliente a comprendere i suoi problemi e a trovare una soluzione. Questo approccio basato sul valore crea fiducia e rende la vendita un processo collaborativo.</li>
    <li>**Minimizza le funzionalità, massimizza i benefici.** Non concentrati sulle caratteristiche del tuo prodotto, ma su come quelle caratteristiche risolvono i problemi del cliente. Trasforma ogni funzionalità in un beneficio chiaro e misurabile.</li>
</ul>
`
            },
            {
                id: 'gitomer',
                title: "Il piccolo libro rosso della vendita",
                author: "Jeffrey Gitomer",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Le persone non comprano ciò che vendi, ma il modo in cui le fai sentire. Smetti di essere un venditore, diventa la persona di cui si fidano, l'amico che risolve i problemi. L'unica cosa che conta non è la vendita, ma la relazione.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>Questo è un manuale conciso e diretto, ricco di consigli pratici e subito applicabili. Gitomer usa un linguaggio informale e schietto per svelare i principi che **distinguono i grandi venditori dagli altri**. Il focus è su come costruire relazioni durature, creare valore per il cliente e "chiudere" le trattative in modo efficace. È un testo perfetto per chi cerca consigli rapidi e concreti.</p>
<ul class="mt-4">
    <li>**Le persone odiano che gli si venda qualcosa, ma amano comprare.** Smettila di "vendere" in modo aggressivo e inizia a creare un ambiente in cui le persone vogliano comprare da te. Offri valore, risolvi problemi e sii un consulente, non un semplice venditore.</li>
    <li>**Il tuo obiettivo non è vendere, ma creare valore.** Chiediti sempre "Che valore posso offrire al cliente?" e poi agisci di conseguenza. Il tuo ruolo è quello di essere utile, di risolvere un problema e di rendere la vita del cliente più facile.</li>
    <li>**Fai domande potenti.** Invece di chiedere "Cosa cerca?", chiedi "Come posso aiutarti a raggiungere il tuo obiettivo?". Questo cambia la dinamica della conversazione, rendendoti un partner, non un avversario.</li>
    <li>**Sii memorabile.** La tua personalità, la tua passione e il tuo approccio unico sono la tua firma. Sii una persona autentica, onesta e appassionata. Le persone comprano da chi si fidano e da chi apprezzano.</li>
    <li>**Le referenze sono il tuo patrimonio.** Non aver paura di chiederle. Se hai offerto valore, il tuo cliente sarà felice di parlare di te con la sua rete di contatti. Le referenze sono il vero indicatore del successo a lungo termine.</li>
    <li>**La preparazione è tutto.** Non presentarti mai a una trattativa impreparato. Conosci il tuo prodotto, il tuo cliente e i tuoi concorrenti. La preparazione ti dà fiducia e ti permette di essere reattivo e incisivo durante la trattativa.</li>
</ul>
`
            },
            {
                id: 'belfort',
                title: "Way of the Wolf",
                author: "Jordan Belfort",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Non si tratta di vendere con la logica, ma di persuadere con la passione. La vendita non è un'arte, ma una scienza che, se padroneggiata, ti rende un maestro del tuo destino e del tuo successo.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>La vendita è una scienza, non una magia. In questo libro, Jordan Belfort svela il suo sistema di vendita, la "Straight Line Persuasion". L'80% di una vendita avviene nei primi 4 secondi di conversazione. Il 20% della tua abilità, ovvero il tuo controllo della linea retta, determina l'esito della trattativa. Belfort si concentra sulla **comunicazione verbale e non verbale** e sull'importanza di stabilire immediatamente fiducia e autorità.</p>
<ul class="mt-4">
    <li>**Le tre certezze.** Per chiudere una vendita, devi creare tre certezze nella mente del cliente: certezza del prodotto, certezza del venditore (te stesso) e certezza dell'azienda. Devi infondere nel cliente la sensazione che ciò che stai vendendo sia la soluzione migliore, che tu sei un professionista fidato e che la tua azienda è solida.</li>
    <li>**La linea retta.** La vendita è una linea retta che va dall'inizio della conversazione (prospettiva) alla chiusura. Non deviare mai. Ogni obiezione, domanda o distrazione del cliente è un tentativo di portarti fuori rotta. Il tuo compito è riportare la conversazione sulla linea retta, mantenendo il controllo.</li>
    <li>**Il tono di voce è il 90% della comunicazione.** Non è tanto quello che dici, ma come lo dici. Il tuo tono di voce deve trasmettere entusiasmo, sicurezza e autorità, senza essere aggressivo. L'inflexion, il ritmo e il volume della voce sono strumenti potenti per connettersi con il cliente a livello subconscio.</li>
    <li>**Supera le obiezioni.** Le obiezioni non sono un rifiuto, ma un'opportunità di vendita. Vengono dal subconscio del cliente che cerca una giustificazione per acquistare. Gestiscile con pazienza e riporta sempre la conversazione sulla linea retta.</li>
    <li>**La vendita è un processo emozionale.** Le persone comprano sulla base delle emozioni e giustificano l'acquisto con la logica. Non concentrarti solo sui fatti e sui numeri, ma connettiti con il cliente a un livello emozionale, facendogli immaginare i benefici che otterrà.</li>
    <li>**Non fare il venditore, sii un consulente.** Questo concetto è centrale anche per Belfort. Non devi "vendere" qualcosa, devi "aiutare" il cliente a risolvere un problema. Il tuo obiettivo è essere il "risolutore" e non il "venditore".</li>
</ul>
`
            },
            {
                id: 'voss',
                title: "Never Split the Difference",
                author: "Chris Voss",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Smetti di cercare il compromesso e inizia a dominare il dialogo. Il tuo vero potere non si trova in ciò che dici, ma in ciò che riesci a far dire agli altri, sbloccando un "sì" che non avresti mai pensato fosse possibile.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>Chris Voss, ex negoziatore dell'FBI, applica le tecniche usate nei negoziati con i rapitori al mondo degli affari. L'idea centrale è che una negoziazione non deve essere un compromesso, ma un processo in cui si cerca di capire le emozioni e le motivazioni profonde dell'altra parte. Voss insegna a usare il **"labeling" (etichettare le emozioni), l'ascolto empatico e le domande calibro** per ottenere un sì senza dover cedere nulla. È un libro eccellente per chiunque si trovi a gestire trattative complesse o a superare obiezioni difficili.</p>
<ul class="mt-4">
    <li>**Ascolto empatico.** Ascolta non solo le parole, ma anche il tono di voce e le emozioni sottostanti. Fai sentire all'altra persona che la stai ascoltando e che la stai capendo davvero.</li>
    <li>**Mirroring.** Ripeti le ultime 1-3 parole che il tuo interlocutore ha appena detto. Questo semplice gesto lo incoraggia a elaborare ulteriormente, rivelando più informazioni senza che si senta sotto pressione.</li>
    <li>**Labeling.** Dai un nome alle emozioni dell'altra persona. "Sembra che tu sia frustrato da questo processo" o "Sembra che tu sia preoccupato per il budget". Questo dimostra empatia e disinnesca le tensioni.</li>
    <li>**Domande calibro.** Invece di fare domande che possono essere risposte con un sì o no, fai domande aperte che iniziano con "come" o "cosa". "Come pensi che potremmo risolvere questo problema?" o "Cosa faresti in questa situazione?". Questo sposta il controllo del processo, facendoti sembrare un consulente.</li>
    <li>**Non avere paura del "no".** Il "no" non è un rifiuto, ma un'opportunità. Ti dà spazio per riorganizzarti, scoprire il vero motivo dell'obiezione e riprendere il controllo del dialogo.</li>
    <li>**La regola del 7-38-55.** Solo il 7% della tua comunicazione è verbale. Il 38% è il tono della voce e il 55% è il linguaggio del corpo. Sii consapevole di come il tuo tono e il tuo linguaggio corporeo influenzano la tua comunicazione.</li>
</ul>
`
            },
            {
                id: 'challenger',
                title: "The Challenger Sale",
                author: "Matthew Dixon e Brent Adamson",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Smetti di compiacere il cliente e inizia a sfidarlo. Non sei un semplice venditore, ma un consulente che insegna, adatta e prende il controllo, perché il tuo valore non è ciò che vendi, ma il modo in cui cambi il modo di pensare del tuo cliente.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>Questo libro rivoluziona l'idea tradizionale del venditore. Basato su una ricerca su migliaia di rappresentanti di vendita, introduce il concetto del "**Challenger**" (lo sfidante), un venditore che non si limita a soddisfare le richieste del cliente, ma lo sfida a pensare in modo diverso. Il "Challenger" insegna, adatta il messaggio e prende il controllo della vendita. È un testo fondamentale per chi opera in contesti B2B complessi e vuole aggiungere valore reale al processo decisionale del cliente.</p>
<ul class="mt-4">
    <li>**Insegna.** Il venditore "Challenger" non parla del suo prodotto, ma insegna al cliente qualcosa di nuovo sulla sua azienda, sulle sue sfide e sulle opportunità che sta perdendo.</li>
    <li>**Adatta.** Ogni messaggio deve essere adattato al contesto specifico del cliente. Non usare un approccio standard, ma personalizza il tuo messaggio per ogni azienda e per ogni interlocutore.</li>
    <li>**Prendi il controllo.** Il venditore "Challenger" non ha paura di prendere il controllo della conversazione, di guidare il cliente attraverso il processo di vendita e di spingerlo a prendere una decisione.</li>
    <li>**Concentrati sul valore.** Il "Challenger" crea valore per il cliente, non solo offrendo un prodotto, ma risolvendo un problema aziendale.</li>
    <li>**Non essere un "costruttore di relazioni".** Il "Challenger" non si limita a costruire relazioni superficiali. Costruisce relazioni profonde e di fiducia basate sulla sua capacità di portare un valore reale al cliente.</li>
    <li>**La vendita è educazione.** Sii un esperto in ciò che vendi e usa la tua conoscenza per educare il cliente e per aiutarlo a prendere la decisione giusta.</li>
</ul>
`
            },
            {
                id: 'sobczak',
                title: "La chiusura non si fa, si ottiene",
                author: "Art Sobczak",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Smetti di pensare a come chiudere la vendita e concentrati su come renderla inevitabile. La vera chiusura è un risultato naturale, non una battaglia da combattere, perché il tuo cliente vuole già dire di sì.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>Contrariamente a molti libri di vendita che si concentrano sul "chiudere" a tutti i costi, Sobczak enfatizza l'importanza di un processo di vendita ben costruito fin dall'inizio. Il suo approccio si basa sull'idea che una vendita ben condotta porta il cliente a volere il prodotto o servizio, rendendo la chiusura un risultato naturale e non una battaglia. Il libro è ricco di **script, domande e strategie pratiche** per migliorare ogni fase del ciclo di vendita.</p>
<ul class="mt-4">
    <li>**Sii un risolutore di problemi.** Non sei un venditore, ma un consulente che aiuta il cliente a risolvere i suoi problemi. Fai domande per capire i suoi bisogni e offri una soluzione che li soddisfi.</li>
    <li>**Crea una relazione di fiducia.** La fiducia è la base di ogni vendita. Sii onesto, trasparente e sincero con il cliente. Fai in modo che il cliente si fidi di te prima di fidarsi del tuo prodotto.</li>
    <li>**Fai le domande giuste al momento giusto.** Le domande sono il tuo strumento più potente. Usale per guidare il cliente attraverso il processo di vendita, per capire le sue obiezioni e per aiutarlo a prendere una decisione.</li>
    <li>**Non avere paura di fare il prezzo.** Il prezzo non è il problema, il valore è il problema. Se il cliente non vede il valore del tuo prodotto, il prezzo sarà sempre troppo alto.</li>
    <li>**La chiusura è un processo, non un evento.** Ogni passo del ciclo di vendita ti avvicina alla chiusura. Non aspettare l'ultimo momento per chiudere la vendita, ma lavora per ottenerla fin dall'inizio.</li>
    <li>**Segui il cliente.** La vendita non finisce quando il cliente ha acquistato. Continua a seguirlo, a offrirgli supporto e a creare un rapporto a lungo termine.</li>
</ul>
`
            },
            {
                id: 'marketing_laws',
                title: "Le 21 Leggi immutabili del marketing",
                author: "Al Ries e Jack Trout",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Il tuo prodotto non è ciò che vendi, ma il modo in cui il cliente lo percepisce. Smetti di concentrarti solo sulla vendita e diventa un maestro del posizionamento, perché non vince il migliore, ma chi si posiziona nella mente del cliente come unico.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>Anche se è un libro di marketing, i suoi principi sono essenziali per ogni venditore. Il marketing e la vendita sono due facce della stessa medaglia, e capire le leggi che governano il posizionamento, la differenziazione e la strategia di un prodotto o servizio è cruciale. Gli autori spiegano in modo chiaro e conciso perché alcune aziende e prodotti hanno successo e altri falliscono, fornendo una prospettiva più ampia che aiuta il venditore a capire come **posizionare sé stesso e la sua offerta sul mercato**.</p>
<ul class="mt-4">
    <li>**Legge del Leadership.** È meglio essere il primo che essere il migliore. Se sei il primo, ti posizioni nella mente del cliente come l'originale.</li>
    <li>**Legge della Categoria.** Se non puoi essere il primo, crea una nuova categoria in cui puoi esserlo.</li>
    <li>**Legge della Mente.** Il marketing non è una battaglia di prodotti, ma di percezioni. Devi posizionarti nella mente del cliente.</li>
    <li>**Legge del Focus.** Riduci il tuo prodotto a un singolo concetto, una singola parola, che ti differenzi dai concorrenti.</li>
    <li>**Legge del Sacrificio.** Per avere successo, devi sacrificare qualcosa. Non puoi essere tutto per tutti. Devi focalizzarti su un'area specifica.</li>
    <li>**Legge della Prospettiva.** Gli effetti del marketing si manifestano nel lungo periodo. Non pensare solo alla vendita di oggi, ma alla reputazione che stai costruendo nel tempo.</li>
</ul>
`
            },
            {
                id: 'blount',
                title: "Fanatical Prospecting",
                author: "Jeb Blount",
                summary: `
<p class="italic text-lg text-center text-gray-300 mb-6">Smetti di inseguire i clienti e diventa un magnete per loro. La tua disciplina e la tua perseveranza nella ricerca di nuove opportunità sono la vera arma segreta, perché una pipeline vuota è il tuo più grande nemico.</p>
<h3 class="text-xl font-bold text-white mt-4 mb-2">Concetti chiave</h3>
<p>La "prospecting" (la ricerca di nuovi clienti) è spesso la parte più difficile della vendita. Jeb Blount affronta questa sfida a testa alta. Il suo libro è una guida pratica e motivazionale per costruire una pipeline di vendite solida. L'autore sottolinea l'importanza di una **disciplina ferrea, dell'uso di più canali e della mentalità giusta** per superare il rifiuto e la procrastinazione. È un libro indispensabile per chiunque abbia bisogno di generare costantemente nuovi lead e appuntamenti.</p>
<ul class="mt-4">
    <li>**Sii ossessivo.** La prospecting è un lavoro a tempo pieno. Devi essere ossessionato dal riempire la tua pipeline.</li>
    <li>**Usa più canali.** Non fare affidamento solo sulle chiamate a freddo. Usa email, social media, eventi e referenze. Sii ovunque i tuoi clienti siano.</li>
    <li>**Non prendere il rifiuto sul personale.** Il rifiuto fa parte del gioco. Sviluppa una "pelle spessa" e un atteggiamento mentale che ti permetta di andare avanti.</li>
    <li>**Sii organizzato.** Pianifica le tue attività di prospecting, traccia i tuoi progressi e mantieniti disciplinato. La costanza è la chiave.</li>
    <li>**La pipeline è tutto.** Una pipeline vuota significa una banca vuota. Se vuoi avere successo, devi sempre avere un flusso costante di nuovi contatti.</li>
    <li>**Sii un esperto.** I clienti non sono interessati al tuo prodotto, ma a come puoi aiutarli. Sii un esperto in ciò che vendi e usa la tua conoscenza per risolvere i problemi dei tuoi clienti.</li>
</ul>
`
            }
        ];

        let videoIndex = 0;
        let userName = '';
        let hasWatchedAVideo = false;
        
        let pillIndex = 0;

        const videoContainer = document.getElementById('videoContainer');
        const confirmButton = document.getElementById('confirmButton');
        const nameInputSection = document.getElementById('nameInputSection');
        const mainAppSection = document.getElementById('mainAppSection');
        const userNameInput = document.getElementById('userNameInput');
        const userNameDisplay = document.getElementById('userNameDisplay');
        const videoProgressDisplay = document.getElementById('videoProgressDisplay');
        const powerPillButton = document.getElementById('powerPillButton');
        const powerPillModal = document.getElementById('powerPillModal');
        const closeButton = powerPillModal.querySelector('.close-button');
        const pillTitle = document.getElementById('pillTitle');
        const pillProgress = document.getElementById('pillProgress');
        const pillContent = document.getElementById('pillContent');
        const nextPillButton = document.getElementById('nextPillButton');
        
        const progressBar = document.getElementById('progressBar');
        const progressPercentage = document.getElementById('progressPercentage');
        const pilloleProgressDisplay = document.getElementById('pilloleProgressDisplay');

        const aiInput = document.getElementById('aiInput');
        const aiButton = document.getElementById('aiButton');
        const aiResponseText = document.getElementById('aiResponseText');
        const objectionInput = document.getElementById('objectionInput');
        const objectionButton = document.getElementById('objectionButton');
        const objectionResponseText = document.getElementById('objectionResponseText');
        const startButton = document.getElementById('startButton');
        const bookContainer = document.getElementById('bookContainer');
        const exportButton = document.getElementById('exportButton');
        const importFile = document.getElementById('importFile');
        
        // Funzione per aggiornare la barra di avanzamento e i contatori
        function updateProgressBar() {
            const percentage = (videoIndex / videos.length) * 100;
            progressBar.style.width = `${percentage}%`;
            progressPercentage.innerText = `${Math.round(percentage)}%`;
            videoProgressDisplay.innerText = `Video visti: ${videoIndex} su 30`;
            
            pilloleProgressDisplay.innerText = `Pillole lette: ${pillIndex}`;
        }
        
        function showMainApp(name) {
            userName = name;
            localStorage.setItem('currentUser', userName);
            nameInputSection.classList.add('hidden');
            mainAppSection.classList.remove('hidden');
            userNameDisplay.innerText = userName;

            videoIndex = parseInt(localStorage.getItem(userName + '-video') || 0);
            pillIndex = parseInt(localStorage.getItem(userName + '-pillole') || 0);
            
            loadVideos();
            loadBooks();
        }

        // Funzione per caricare due video alla volta
        function loadVideos() {
            videoContainer.innerHTML = '';
            hasWatchedAVideo = false;
            confirmButton.classList.add('opacity-50', 'cursor-not-allowed');
            
            updateProgressBar();

            if (videoIndex >= videos.length) {
                videoContainer.innerHTML = `
                    <div class="md:col-span-2 text-center py-10 px-4">
                        <h2 class="text-4xl font-bold text-green-500 mb-4">BRAVO, SEI SULLA STRADA DI FARE GRANDI COSE!</h2>
                        <p class="text-lg text-gray-300">Hai completato il ciclo di formazione di oggi. Il percorso ricomincia ora.</p>
                    </div>
                `;
                videoIndex = 0;
                confirmButton.innerText = 'Ricomincia';
                localStorage.setItem(userName + '-video', videoIndex);
            } else {
                confirmButton.innerText = 'Prossimi video';
                for (let i = 0; i < 2; i++) {
                    if (videoIndex < videos.length) {
                        const videoData = videos[videoIndex];
                        const videoCard = document.createElement('div');
                        videoCard.className = 'bg-[#161b22] p-6 rounded-xl shadow-lg border border-[#21262d] video-container';
                        videoCard.innerHTML = `
                            <h2 class="text-2xl font-bold mb-4 text-white">${videoData.title}</h2>
                            <div class="relative pt-[56.25%] mb-4">
                                <iframe 
                                    class="absolute inset-0 w-full h-full rounded-lg" 
                                    src="${videoData.url}" 
                                    title="${videoData.title}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                            </div>
                            <p class="text-gray-400 text-sm">${videoData.description}</p>
                        `;
                        videoContainer.appendChild(videoCard);
                        videoIndex++;
                    }
                }
            }
        }

        // Funzione per caricare le card dei libri
        function loadBooks() {
            bookContainer.innerHTML = '';
            booksData.forEach(book => {
                const bookCard = document.createElement('div');
                bookCard.className = 'bg-[#161b22] p-6 rounded-xl shadow-lg border border-[#21262d] cursor-pointer hover:bg-[#21262d] transition-colors';
                bookCard.setAttribute('data-book-id', book.id);
                bookCard.innerHTML = `
                    <h3 class="text-xl font-bold text-white mb-2">${book.title}</h3>
                    <p class="text-gray-400 text-sm">Di: ${book.author}</p>
                `;
                bookContainer.appendChild(bookCard);
            });
        }

        async function generateAIResponse(prompt) {
            const payload = {
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }]
            };
            const apiUrl = `/.netlify/functions/gemini-proxy`;
            
            let retries = 3;
            let delay = 1000;
            let resultText = "Errore nella generazione della risposta. Riprova più tardi.";

            while (retries > 0) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) { // Too Many Requests
                        retries--;
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2; // Exponential backoff
                        continue;
                    }
                    if (response.ok) {
                        const result = await response.json();
                        resultText = result.candidates?.[0]?.content?.parts?.[0]?.text || "Errore nella generazione della risposta. Riprova più tardi.";
                    } else {
                        console.error('API call failed with status:', response.status);
                        resultText = `Errore API: ${response.status}. Riprova più tardi.`;
                    }
                    break;

                } catch (error) {
                    console.error('API call failed:', error);
                    resultText = "Errore di rete. Riprova più tardi.";
                    break;
                }
            }
            return resultText;
        }

        async function loadPillole() {
            let pills = JSON.parse(localStorage.getItem(userName + '-dynamic-pillole')) || [];
            
            pillIndex = parseInt(localStorage.getItem(userName + '-pillole') || 0);
            
            // Nascondi pulsante "prossima pagina" per i libri, mostralo per le pillole
            nextPillButton.classList.remove('hidden');

            let pillola;
            if (pillIndex < pilloleDiPotenza.length) {
                pillola = pilloleDiPotenza[pillIndex];
            } else if (pillIndex < pilloleDiPotenza.length + pills.length) {
                pillola = pills[pillIndex - pilloleDiPotenza.length];
            } else {
                pillTitle.innerText = "Caricamento...";
                pillContent.innerHTML = "<p>Stiamo creando una nuova pillola di potenza per te. Attendi un momento...</p>";
                // Prompt ottimizzato per stile incisivo ma costruttivo
                const newPillolaContent = await generateAIResponse("Scrivi un paragrafo motivazionale di massimo 4 frasi per un venditore. Il tono deve essere incisivo ma costruttivo, focalizzato sul dare valore e aumentare la fiducia. Non usare volgarità o offese. Il testo deve trasformare una paura o un dubbio in un'opportunità di crescita e spingere all'azione con determinazione e fiducia in sé stessi. La pillola deve rafforzare l'idea che la perseveranza è un segno di forza, non di debolezza.");
                
                pills.push({ title: `Pagina ${pillIndex + 1}`, content: newPillolaContent });
                localStorage.setItem(userName + '-dynamic-pillole', JSON.stringify(pills));
                pillola = pills[pills.length - 1];
            }

            pillTitle.innerText = pillola.title || `Pagina ${pillIndex + 1}`;
            pillContent.innerHTML = `<p class="whitespace-pre-wrap">${pillola.content}</p>`;
            pillProgress.innerText = `Pagina ${pillIndex + 1} di ∞`;
            nextPillButton.innerText = 'Prossima pagina';
        }
        
        function showBookSummary(bookId) {
            const book = booksData.find(b => b.id === bookId);
            if (!book) return;

            // Nascondi il pulsante "prossima pagina" per i libri
            nextPillButton.classList.add('hidden');
            
            pillTitle.innerText = book.title;
            pillContent.innerHTML = book.summary;
            pillProgress.innerText = `Riassunto del libro`;
            powerPillModal.style.display = 'block';
        }

        function nextPillola() {
            pillIndex++;
            localStorage.setItem(userName + '-pillole', pillIndex);
            updateProgressBar();
            loadPillole();
        }

        async function getAIResponse() {
            const userInput = aiInput.value.trim();
            if (userInput === "") {
                // Sostituisci alert con un messaggio visibile nell'interfaccia
                aiResponseText.innerText = "Scrivi il tuo blocco o dubbio per ricevere una risposta.";
                return;
            }

            aiResponseText.innerText = "Caricamento...";
            // Prompt ottimizzato per stile incisivo ma costruttivo
            const prompt = `Agisci come un mentore di vendita d'élite, diretto ma costruttivo. Rispondi al seguente blocco o dubbio da un venditore: "${userInput}". La tua risposta deve essere incisiva, focalizzata sul dare valore e aumentare la fiducia. Trasforma il dubbio in un'opportunità di crescita. Fornisci una risposta in 3-4 frasi, senza formalismi o offese. Sii d'impatto e orientato all'azione.`;
            const aiText = await generateAIResponse(prompt);
            aiResponseText.innerText = aiText;
        }

        async function getObjectionResponse() {
            const userInput = objectionInput.value.trim();
            if (userInput === "") {
                objectionResponseText.innerText = "Scrivi l'obiezione che ti spaventa per ricevere una risposta.";
                return;
            }
            objectionResponseText.innerText = "Caricamento...";
            // Prompt per il closer AI
            const prompt = `
Agisci come un closer esperto, diretto e pratico. L'obiezione è: "${userInput}".

1.  **Analisi dell'obiezione:** Spiega in modo conciso e diretto il motivo reale dietro questa obiezione (mancanza di valore, timore, stakeholder, ecc.).
2.  **Trial Closing:** Spiega in una frase semplice e chiara cos'è un "trial closing" e come si applica all'obiezione specifica.
3.  **Esempio di Dialogo Pratico:** Fornisci un breve esempio di dialogo in cui la tecnica del trial closing viene applicata per superare l'obiezione.
4.  **Riflessione Strategica:** Concludi con una nota finale che spiega al venditore che questi consigli sono una linea guida, e devono essere adattati al suo stile e al contesto specifico del cliente, non seguiti alla lettera.
`;
            const aiText = await generateAIResponse(prompt);
            objectionResponseText.innerText = aiText;
        }

        // Funzione per esportare i dati
        function exportProgress() {
            const data = {};
            // Salva tutti i dati rilevanti di localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(userName + '-')) {
                    data[key] = localStorage.getItem(key);
                }
            }
            data['currentUser'] = userName;
            data['videoIndex'] = videoIndex;
            data['pillIndex'] = pillIndex;
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `progressi_${userName}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Funzione per importare i dati
        function importProgress(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData['currentUser']) {
                        // Sostituisci i dati attuali con quelli importati
                        localStorage.setItem('currentUser', importedData['currentUser']);
                        localStorage.setItem(importedData['currentUser'] + '-video', importedData['videoIndex']);
                        localStorage.setItem(importedData['currentUser'] + '-pillole', importedData['pillIndex']);

                        // Resetta i dati dinamici per evitare conflitti, se necessario
                        if (importedData[importedData['currentUser'] + '-dynamic-pillole']) {
                           localStorage.setItem(importedData['currentUser'] + '-dynamic-pillole', importedData[importedData['currentUser'] + '-dynamic-pillole']);
                        } else {
                           localStorage.removeItem(importedData['currentUser'] + '-dynamic-pillole');
                        }
                        
                        // Ricarica la pagina per applicare i nuovi dati
                        window.location.reload();
                    }
                } catch (error) {
                    alert('Errore durante l\'importazione del file. Assicurati che sia un file JSON valido.');
                }
            };
            reader.readAsText(file);
        }


        // Event Listeners
        startButton.addEventListener('click', () => {
            const name = userNameInput.value.trim();
            if (name) {
                showMainApp(name);
            } else {
                // Sostituisci alert con un messaggio visibile nell'interfaccia
                document.getElementById('welcomeMessage').innerText = "Inserisci il tuo nome per iniziare!";
                document.getElementById('welcomeMessage').classList.remove('hidden');
            }
        });

        videoContainer.addEventListener('click', () => {
            if (!hasWatchedAVideo) {
                hasWatchedAVideo = true;
                confirmButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });
        
        confirmButton.addEventListener('click', (event) => {
            if (!hasWatchedAVideo) {
                // Sostituisci alert con un messaggio visibile nell'interfaccia
                document.getElementById('welcomeMessage').innerText = "Devi guardare almeno un video prima di poter confermare!";
                document.getElementById('welcomeMessage').classList.remove('hidden');
                event.preventDefault();
            } else {
                localStorage.setItem(userName + '-video', videoIndex);
                loadVideos();
            }
        });

        powerPillButton.addEventListener('click', () => {
            powerPillModal.style.display = 'block';
            loadPillole();
        });

        closeButton.addEventListener('click', () => {
            powerPillModal.style.display = 'none';
        });

        nextPillButton.addEventListener('click', () => {
            nextPillola();
        });

        aiButton.addEventListener('click', getAIResponse);
        objectionButton.addEventListener('click', getObjectionResponse);

        bookContainer.addEventListener('click', (event) => {
            const bookCard = event.target.closest('[data-book-id]');
            if (bookCard) {
                const bookId = bookCard.getAttribute('data-book-id');
                showBookSummary(bookId);
            }
        });

        exportButton.addEventListener('click', exportProgress);
        importFile.addEventListener('change', importProgress);

        window.onload = () => {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                showMainApp(savedUser);
            }
        };
    </script>
</body>
</html>